<html>
<head>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
	<script async src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	
	<link rel="stylesheet" href="res/magnify.css">
	<script async src="res/magnify.js"></script>

<title>Chester the AI Radiology Assistant</title>

<meta property="og:site_name" content="Chester the AI Radiology Assistant" />
<meta property="og:locale" content="en_US" />  
<meta property="og:type" content="article" />
<meta property="og:image" content="https://mlmed.org/tools/xray/res/share.png" />
<meta property="og:title" content="Chester the AI Radiology Assistant" />

<meta name="twitter:card" content="summary"></meta>
<meta property="og:url" content="https://mlmed.org/tools/xray/" />
<meta property="og:title" content="Chester the AI Radiology Assistant" />
<meta property="og:description" content="This is a web based (but locally run) system for diagnosing chest X-Rays. Code is delivered via a URL but the patient data remains on the users machine and all processing occurs locally. The system is designed to be used as a reference where a user can process an image to confirm or aid in their diagnosis. The system contains three main components: out-of-distribution detection, disease prediction, and prediction explanation." />
<meta property="og:image" content="https://mlmed.org/tools/xray/res/share.png" />


<meta name="title" content="Chester the AI Radiology Assistant">
<meta name="description" content="This is a web based (but locally run) system for diagnosing chest X-Rays. Code is delivered via a URL but the patient data remains on the users machine and all processing occurs locally. The system is designed to be used as a reference where a user can process an image to confirm or aid in their diagnosis. The system contains three main components: out-of-distribution detection, disease prediction, and prediction explanation. ">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131584004-1', 'mlmed.org');
  ga('send', 'pageview');
</script>

<script src="res/tf-2.0.1.min.js"></script>
<script src="res/ssim.js"></script>
<script src="res/js-colormaps.js"></script>
<script src="res/jquery.sparkline.min.js"></script>


<link rel='stylesheet' href='style.css' type='text/css' media='all' />
</head>

<script>

function showAbout(){
	$("#aboutbtn").addClass("active");
	$(".about").show();
	
}

function hideAbout(){
	$("#aboutbtn").removeClass("active");
	$(".about").hide();
	setCookie('about','about',9999);
}


$(function(){
	
	if (getCookie("about") != "about"){
		showAbout();
	}
	
	$("#aboutbtn").click(function(){
		
		if (!$(".about").is(":visible")){
			showAbout();
		}else{
			hideAbout();
		}
	});
	
});

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+ d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}




</script>

<body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"><img src="res/dr-convnet-icon.png"/></a>
          <a  class="navbar-brand" href="#">Chester the AI Radiology Assistant</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li id="aboutbtn"><a href="#">About</a></li>
          </ul>
        </div>
      </div>
    </nav>
	<div class="container" style="width: 100%;min-width: 1024px;">


	
		<div class="col-sm-12" style="">
		<div class="col-md-2"></div>
<div class="col-md-8">

          <div class="about" style="display:none;">
            <h2 class="blog-post-title"><img src="res/dr-convnet-small.png">Chester the AI Radiology Assistant</h2>

            <p>
		NOT FOR MEDICAL USE. This is a web based (but locally run) prototype system for diagnosing chest X-ray images. 
		The patient data remains on your computer and all computation occurs in your browser. 
		The goals of this system are:
			</p>
			
			<ol>
			<li>Let people play with deep learning tools to know how they work and their limitations.</li>
			<li>Show the potential of open data (needed to build a public system like this).</li>
			<li>Create a tool to help teach radiology.</li>
			<li>Demonstrate a model delivery system that can scale to provide free medical tools to the world.</li>
			</ol>
			<br>
		<center>
		<iframe style='padding-bottom: 15px;max-width:700px' width="100%" height="470" src='//www.youtube.com/embed/IbkxHKXjaQo?html5=1&showinfo=0&rel=0&autohide=1&theme=light&color=white&hd=1' frameborder='0' allowfullscreen></iframe>
		</center>

         
        The system contains three main components: <br>
        
        <b>Out Of Distribution error:</b>
        This is a heatmap showing how the image differs from our training data. 
        If the heatmap is too bright then the image is very different from our training data and the model will likely not work.
        We will prevent an image from being processed if it is not similar enough to our training data in order to prevent errors in predictions.
        <br>
        
        <b>Predictive image regions: </b>
        The brighter each pixel is in the heatmap the more influence it can have on the predictions. 
        If the color is bright it means that a change in these pixels will change the prediction. 
        <br>
        
        <b>Disease Predictions:</b>
        A probability indicating how likely the image contains the disease. 50% means the network is not sure. 
        <br>
        <br>
        <b>Technical Report:</b> <a href="https://arxiv.org/abs/1901.11210">https://arxiv.org/abs/1901.11210</a>
        
     	
        
        
        <center><a href="javascript:hideAbout();"><button type="button" class="btn btn-warning">hide this</button></a></center>
          <hr>
          </div>


        </div>
				
		</div>

<div class="col-sm-12">

	<div class="alert alert-warning" role="alert" style="width: 100%">
		<center>
			NOT FOR MEDICAL USE. This is a prototype system for diagnosing
			chest x-rays using neural networks. All processing is done on your
			device and images are not sent to the server. If you continue you
			assume all liability when using the system. A neural network model
			(~150mb) will be downloaded to your browser.
			<button id="agree" type="button" class="btn btn-danger">Accept NOT FOR MEDICAL USE</button>
		</center>
	</div>

	<div class="col-sm-12">
	<div style="float:right;">
		<span style="" >Made by:
		<a href="https://mlmed.org"><img style="width:200px" src="res/mlmed.png"/></a>
		and
		<a href="https://mila.quebec"><img style="width:150px" src="res/mila-medical-logo-new-small.png"/></a>
		</span>
	</div>
				
	By Joseph Paul Cohen, Paul Bertin, and Vincent Frappier 2019<br>
	New: Download the offline version <a href="https://github.com/mlmed/dl-web-xray/releases/download/2.0/Chester.app.zip">here</a> for Mac OSX<br>
	
	</div>

	<div class="col-sm-12">
		<div id="file-container" style="display: none">
			Process an image locally: <input type="file" id="files" name="files[]" multiple> 
			<a target="_blank" href="examples/">Download example files (opens new window)</a><br>
			<a href="javascript:downloadCSV();">Download all predictions as CSV</a>
		</div>
	</div>
	
	<div class="col-sm-12">
		<span id="info" style="color:red"></span>	
		<center><div id="status" class="status"></div></center>
	</div>
	
</div>

		
<div id="predictions">

	<div id="predtemplate" class="prediction col-xs-12" style="display:none">
		<div class="topbar">
		<center><span class="imagename">&nbsp;</span></center>
		</div>
		<div class="col-xs-12" style="padding:0px;margin-bottom: 10px">
		<div class="col-xs-8">
<!-- 			<center style=""><b>Image</b> -->
<center>
  <div class="toolbar btn-group">
      <button class="btn btn-default btn-invert-colors" data-original-title="Invert colors">
		<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-half" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
		  <path fill-rule="evenodd" d="M8 15V1a7 7 0 1 1 0 14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
		</svg> Invert colors
	  </button>
      <button class="btn btn-default btn-raw-gradients" data-original-title="raw gradients">
      	<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cpu" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
		  <path fill-rule="evenodd" d="M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14a2.5 2.5 0 0 1-2.5 2.5v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0zm-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3h-7zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5v-3zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
		</svg> Raw Gradients
	  </button>
      <button class="btn btn-default btn-reset-layers" data-original-title="reset layers">
      	<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-layers" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
		  <path fill-rule="evenodd" d="M3.188 8L.264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l-1.063.567L14.438 10 8 13.433 1.562 10 4.25 8.567 3.187 8z"/>
		  <path fill-rule="evenodd" d="M7.765 1.559a.5.5 0 0 1 .47 0l7.5 4a.5.5 0 0 1 0 .882l-7.5 4a.5.5 0 0 1-.47 0l-7.5-4a.5.5 0 0 1 0-.882l7.5-4zM1.563 6L8 9.433 14.438 6 8 2.567 1.562 6z"/>
		</svg> Reset layers
	  </button>
  </div>
</center>
		</div>
		<div class="col-xs-4">
			<center style=""><b>Pathology Risk</b>
			<br><span style="font-size: x-small">The white center region indicates that the model is not sure.</span>
			</center>
		</div>
		</div>
		
		<div class="col-xs-8" style="">
			<div class="viewbox">
				<canvas class="layer inputimage_highres baselayer"></canvas>
				<canvas class="layer inputimage" style="display:none;"></canvas>
				<canvas class="layer inputimage_rec" style="display:none;"></canvas>
				<canvas class="layer recimage" style="display:none;"></canvas>
				<canvas class="layer oodimage" style="opacity: 0.5;display:none;"></canvas>
				<canvas class="layer gradimage" style="filter:blur(0.89rem)"></canvas>
				<center class="layer loading" style="display:none;margin-top:5%;width:100%;"><img style="width:400px;" alt="Loading..." src="res/loading1.gif"/></center>
			</div>
			<center><span class="desc"></span></center>
			</span>
			
			<center>
				<button style="display:none" type="button" class="oodtoggle btn btn-danger btn-xs">
				Show OOD heatmap
				</button>
			</center>
				
<!-- 			<center><div style="margin-top:40%;display:none" class="computegrads"></div></center> -->
			
		</div>
		<div class="col-xs-4 predviz">
		<center class="loading"><img style="margin-top:40%;" alt="Loading..." src="https://i.imgur.com/yoS0cXm.gif"/></center>
		
		<center>
		<div class="predbox" style="width:100%">

		</div>
		</center>
		</div>
		</div>
		<hr>
	</div>


</div>	
<img id="defaultImage" src="examples/auntminnie-d-2020_01_28_23_51_6665_2020_01_28_Vietnam_coronavirus.jpeg" style="display:none" />
		
</div>
</body>

<canvas id="zoom" width="100" height="50" style="width:400px; height:200px;position:absolute; top:0; left:0; display:none;image-rendering:pixelated"></canvas>

<script src="system.js?v=1.194"></script>
<script>
let statusElement;
let status;

$(function(){
	statusElement = document.getElementById('status');
	
	status = function(msg){statusElement.innerText = msg;console.log("Status: " + msg)};
});

$(function(){
	testBrowser();
	$("#agree").click(function(){
		$("#agree").hide()
		run();
	});
	
	if (findGetParameter("accept") == "true"){
		$("#agree").hide()
		hideAbout()
		run();
	}
});

function testBrowser(){
	
	try{
		new Promise(function(resolve){setTimeout(resolve, 1)});
	}catch(err) {
		status("Error! Your browser may be unsupported. (" + err.message + ")");
		console.log(err)
	}
}

</script>


<br>

<center>
<table class="tg">
  <tr>
    <th class="tg-baqh" colspan="2">System Information</th>
  </tr>
  <tr>
    <td class="tg-0lax">Version</td>
    <td class="tg-0lax">3.0 PROTOTYPE (Old versions: <a href="/tools/xray-v1">v1</a>)</td>
  </tr>
  <tr>
    <td class="tg-0lax">Prediction Model</td>
    <td class="tg-0lax">DenseNet-121 (Input 224x224) xrv-all-45rot15trans15scale (TorchXRayVision)</td>
  </tr>
  <tr>
    <td class="tg-0lax">Out of Distribtion Model</td>
    <td class="tg-0lax">Autoencoder (Input 64x64) ae-chest-savedmodel-64-512</td>
  </tr>
  <tr>
    <td class="tg-0lax">Training data</td>
    <td class="tg-0lax">7 datasets</td>
  </tr>
  <tr>
    <td class="tg-0lax">Samples</td>
    <td class="tg-0lax">106,381 training images</td>
  </tr>
  <tr>
    <td class="tg-0lax">Data sent off device</td>
    <td class="tg-0lax">No</td>
  </tr>
</table>

</center>

<a href="https://github.com/mlmed/dl-web-xray/issues" id="chat-link" target="_blank"><i class="glyphicon glyphicon-envelope"></i>Send Feedback</a>


</html>
